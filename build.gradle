// TIP this have to be on top of the build script
// TIP this Plugin will be applied  for every subject
plugins {
    id "io.swagger.core.v3.swagger-gradle-plugin" version "2.0.7"
}

group 'arkadi'
version '1.0-SNAPSHOT'

repositories {
    mavenCentral()
}

allprojects {
    task micro(type: War) {
        doFirst { task ->
            println "I'm $task.project.name"
        }
    }
}

subprojects {
    apply plugin: 'war'
    apply plugin: "io.swagger.core.v3.swagger-gradle-plugin"

    repositories {
        mavenCentral()
    }

    dependencies {
        providedCompile 'javax:javaee-api:7.0'
        providedCompile 'fish.payara.extras:payara-embedded-web:5.184'
        compile 'com.h2database:h2:1.4.197'
    }

    group 'arkadi'
    sourceCompatibility = 1.8

    micro {
        doLast {
            println "- depend on micro"
        }
        afterEvaluate { Project project ->
            doLast {
                println "- $project.name finished build"
            }
        }
    }
}


project(':api') {

    dependencies {
        compile project(':lib')
    }

    configurations {
        api
    }
    //TIP modify task created for all projects in the all-projects clauses  
    micro {
        baseName = 'api-micro'

    }

    artifacts {
        api micro
    }

    resolve {
        outputFileName = 'PayaraAPI'
        outputFormat = 'JSON'
        prettyPrint = 'TRUE'
        classpath = sourceSets.main.runtimeClasspath
        resourcePackages = ['com.arkadi.customers.api.rest']
        outputPath = 'main/resspurces'
    }
}